---
title: "Still More Interaction Models"
output: 
  html_notebook:
    theme: united
    highlight: tango
bibliography: epsy8251.bib    
csl: apa-single-spaced.csl
---

# Introduction and Research Question

In this set of notes, we will focus on interaction effects between two categorical predictors. We will use the *iron-deficiency.csv* data in this set of notes. In particular, we are going to examine the question of whether cooking pots made of different materials explains variation in iron content 

In less-developed countries, malnutrition is an ongoing problem. Iron-deficiency aneemia, one of the most common forms of malnutrition, affects about 50% of women and children and about 25% of men. The effects  of anemia have obvious implications for the health and welfare of a country's populace and can also lead to economic reprecussions. As such, many countries are interested in cost-effective and convenient strategies to alleviate this problem.

Adish et al. hypothesized that the use of iron cooking pots might be one potential solution, since cooking in an iron
pot would leach iron into foods prepared in them. (Iron cooking pots were used routinely in many developing countries, but were generally abandoned in favor of cheaper and lighter aluminium pots.). What is the effect of cooking pot material on the iron content of cooked food? To study this, researchers cooked each of three typical Ethiopian meals (Shiro Wet', Yesiga Wet', Ye-atkilt Allych'a) in an aluminium pot, a clay pot, and an iron pot. All dishes were prepared according to specified recipes from the Ethiopian Nutritional Institute. The meals were then analysed for the total iron leftover in the cooked food for absorption by the human body.

The dataset, *iron-deficiency.csv*, includes the following variables for 200 4th graders: 

- `id`: Laboratory sample ID
- `iron`: The total iron leftover for absorption by the human body after cooking (as a percentage of total iron)
- `pot`: Categorical variable representing the type of cooking pot used (`Aluminum`; `Clay`; or `Iron`)
- `food`: Categorical variable representing the type of food (`Legumes` = Shiro Wet'; `Meat` = Yesiga Wet'; and `Vegetables` = Ye-atkilt Allych'a)

The data come from Adish, A. A., Esrey, S. A., Gyorkos, T. W., Jean-Baptiste, J., \& Rojhani, A. (1999). Effect of consumption of food cooked in iron pots on iron status and growth of young children: A randomised trial. *The Lancet, 353*, 712--716.

# Preparation
```{r preparation, warning=FALSE, message=FALSE}
# Read in data
anemia = read.csv(file = "~/Documents/epsy-8251/data/iron-deficiency.csv")
head(anemia)

# Load libraries
library(dplyr)
library(ggplot2)
library(sm)
```

# Examine Potential Main Effects of Pot Type

A quick examination of the data suggest that there are differences in the mean available iron content between pot types in the sample.  

```{r message=FALSE, warning=FALSE}
## Examine numeric evidence for race differences
pot_anemia = anemia %>% 
  group_by(pot) %>% 
  summarize( M = mean(iron), SD = sd(iron), N = n() )

pot_anemia


# Create plot to examine race differences
ggplot(data = pot_anemia, aes(x = pot, y = M)) +
  geom_line(aes(group = 1), color = "black", linetype = "dotted") +
  geom_point(size = 5, pch = 17) +
	theme_bw() +
	xlab("Pot type") +
	ylab("Mean iron content")
```

To examine whether the sample differences are simply due to chance, we will fit the simple regression model. Because there are more than two levels for the `pot` variable, to examine whether pot type has a significant effect on iron content, we will fit an intercept-only model and the model that includes the effect of pot type, and use the nested $F$-test to compare the models. (Note that the intercept-only model is nested in every regression model.)

```{r}
lm.0 = lm(iron ~ 1, data = anemia)
lm.1 = lm(iron ~ 1 + pot, data = anemia)
anova(lm.0, lm.1)
```

The test suggests a statistically significant effect of pot type on iron content, $F(2,33)=26.36$, $p<.001$. Examining the summary output (not shown) we find that differences in pot type explain 61.5% of the variation in iron content available in food. 

One explanation for the differences in iron content is the type of food cooked in the pot. We can control for that by fitting a model that includes the effects of pot type and the effects of food type. To see if there is an effect of pot type, after controlling for differences in food type, we fit a model that includes the effects of food type, and then compare it to a model that includes the effects of food type and pot type.

```{r}
lm.2 = lm(iron ~ 1 + food, data = anemia)
lm.3 = lm(iron ~ 1 + food + pot, data = anemia)
anova(lm.2, lm.3)
```

The test suggests a statistically significant effect of pot type on iron content, even after conrolling for differences in food type $F(2,31)=24.89$, $p<.001$. Examining the summary output (not shown) we find that differences in pot type and food type explain 84.48% of the variation in iron content available in food. 

## Plotting the Main-Effects Model

To understand the main-effects model, we plot the results.

```{r}
# Create new data set with main effects
plotData = expand.grid(
  pot = c("Aluminum", "Clay", "Iron"),
  food = c("Legumes", "Meat", "Vegetables")
)

# Use fitted model to compute fitted values for the data
plotData$yhat = predict(lm.3, newdata = plotData)
head(plotData)

# Plot the fitted model
ggplot(data = plotData, aes(x = pot, y = yhat, color = food)) +
  geom_line(aes(group = food), linetype = "dotted") +
  geom_point() +
  theme_bw() +
  xlab("Pot type") +
  ylab("Predicted average iron content") +
  scale_color_brewer(name = "", palette = "Set1")
```

First note that the line segments are parallel. This suggests that the effect of pot type is exactly the same for each type of food. In general, the mean iron content available for consumption for food cooked in an iron pot is highest, followed by clay and aluminum pots, which seem to have similar percentages of iron, on average. (Note that since the two predictors are categorical, the only thing that matters are the points in this plot, because the only y-hat values that really exist are for a particular pot and food type. The lines are added only to help us interpret the effects.)

# Examining the Potential Interaction Between Pot Type and Food Type

Another question a researcher might ask is whether the effect of pot type IS DIFFERENT depending on the type of food being cooked. Asking about whether there is an intereaction between two categorical variables is akin to asking whether the mean $Y$ is different for the different combinations of the two predictors. In our example, is the mean iron content different for the different combinations of food type and pot type.


```{r}
## Examine numerical evidence for interaction
pot_food_anemia = anemia %>% 
  group_by(pot, food) %>% 
  summarize( M = mean(iron), SD = sd(iron), N = n() )

pot_food_anemia


# Create plot to examine the potential interaction
ggplot(data = pot_food_anemia, aes(x = pot, y = M, color = food)) +
  geom_line(aes(group = food), color = "black", linetype = "dotted") +
  geom_point(size = 5, pch = 17) +
	theme_bw() +
	xlab("Pot type") +
	ylab("Mean iron content") +
  guides(color = FALSE) +
  scale_color_brewer(palette = "Set2")
```

The sample data suggests a potential interaction between pot type and food type on iron content. There is variation in the sample means (they are not all the same). To examine whether these differences are more than we would expect because of sampling error, we need to fit an interaction model and examine the different effects. 

# Fitting an Interaction Model

To test the potential interaction effect between sex and race, we will fit a main-effects model (already fitted in `lm.3`) and the interaction model, and then use the nested $F$-test.

```{r}
# Fit interaction model
lm.4 = lm(iron ~ 1 + food + pot + food:pot, data = anemia)

# Nested F-test
anova(lm.3, lm.4)
```

The test suggests a statistically significant interaction effect between pot type and food type on iron content, $F(4,27)=4.89$, $p=.004$. 

## Interpreting the Interaction Effect

To understand this interaction better we can plot the model results.

```{r}
# Create new data set with main effects
plotData = expand.grid(
  pot = c("Aluminum", "Clay", "Iron"),
  food = c("Legumes", "Meat", "Vegetables")
)

# Use fitted model to compute fitted values for the data
plotData$yhat = predict(lm.4, newdata = plotData)
head(plotData)

# Plot the fitted model
ggplot(data = plotData, aes(x = pot, y = yhat, color = food)) +
  geom_line(aes(group = food), linetype = "dotted") +
  geom_point() +
  theme_bw() +
  xlab("Pot type") +
  ylab("Predicted average iron content") +
  scale_color_brewer(name = "", palette = "Set1")
```

Cooking food in an iron pot leaves the highest percentage of iron content leftover for absorption by the human body, regardless of food type. This effect is even higher when cooking meat. 

## Understanding Pot Type x Food Type Differences

Researchers may want to dig deeper into which pot type/food type combinations statistically differ in their mean iron content. All we currently know is that there is an interaction effect, which means that at least one pot type/food type differs. To figure out which are different, we need to examine the `summary()` output from the model.

```{r}
summary(lm.4)
```

The fitted equation is,

$$
\begin{split}
\hat{\mathrm{iron~content}} = & 2.3 - 0.3(\mathrm{meat}) - 1.1(\mathrm{vegetables}) + 0.1(\mathrm{clay~pot}) + 1.3(\mathrm{iron~pot}) -0.02(\mathrm{meat})(\mathrm{clay~pot}) + \\
& 0.09(\mathrm{vegetables})(\mathrm{clay~pot}) + 1.3(\mathrm{meat})(\mathrm{iron~pot}) + 0.2(\mathrm{vegetables})(\mathrm{iron~pot}).
\end{split}
$$

The reference group in the fitted model is legumes cooked in aluminum pots. All of the variables in the model are dummy coded 0 or 1, so to find the mean iron content for a particular food/pot type, we substitute in the appropriate set of 0s and 1s.

The intercept gives the mean iron content for legumes cooked in an aluminum pot ($\hat\beta_0=2.3$). What about for meat cooked in an luminum pot? Substituting in a 1 for `meat` and a 0 for `vegetables`, `iron pot`, and `clay pot`, we find that the mean iron content for meat cooked in an aluminum pot is 2.0, a mean difference of $-0.3$. We can continue making substitutions to compute the mean iron content for each of the pot type/food type combinations. 
         
| Pot Type | Food Type | Computation            | Mean Iron Content |
|----------|:---------:|:----------------------:|:-----------------:|
| Aluminum | Legume    | 2.3                    | 2.3               |
| Aluminum | Meat      | 2.3 - 0.3              | 2.0               |
| Aluminum | Vegetable | 2.3 - 1.1              | 1.2               |
| Clay     | Legume    | 2.3 + 0.1              | 2.4               |
| Clay     | Meat      | 2.3 - 0.3 + 0.1 - 0.02 | 2.08              |
| Clay     | Vegetable | 2.3 - 1.1 + 0.1 + 0.09 | 1.39              |
| Iron     | Legume    | 2.3 + 1.3              | 3.6               |
| Iron     | Meat      | 2.3 - 0.3 + 1.3 + 1.3  | 4.6               |
| Iron     | Vegetable | 2.3 - 1.1 + 1.3 + 0.2  | 2.7               |


Looking at the table, we can see that the coefficients in the fitted model for the main-effects represent the difference between the reference group and combinations with at least one of the food type or pot type in common to the reference group:

- Intercept: The mean iron content for legumes cooked in an aluminum pot (reference group).
- Main-effect of `meat`: Difference in iron content between the reference group and meat cooked in an aluminum pot.
- Main-effect of `vegetables`: Difference in iron content between the reference group and vegetables cooked in an aluminum pot.
- Main-effect of `clay pot`: Difference in iron content between the reference group and legumes cooked in a clay pot.
- Main-effect of `iron pot`: Difference in iron content between the reference group and legumes cooked in an iron pot.

The interaction effects are less directly interpretable. This is because the mean iron content is computed using the main effects and the interaction effect for those combinations that differ from the reference group in both food and pot type. For example, for meat cooked in a clay pot we have to add the main-effect for meat, the main-effect for clay pot, and the interaction effect:

$$
\begin{split}
\hat{\mathrm{iron~content}} &= 2.3 - 0.3(1) + 0.1(1) - 0.02(1)(1) + \\
&= 2.08 
\end{split}
$$

The interaction effect represents the additional combination effect beyond the separate main effects. Interaction terms are difficult to interpret without considering the constituent main-effects. This is why we always leave the constituent main-effects in the model, regardless if they are statistically significant.

## Differences in the Pot/Food Type Combinations

If you are interested in the differences between pot/food type combinations, you need to fit several different models (with varying reference groups) and collect the appropriate $p$-values (which are unadjusted), and then adjust them based on the number of comparisons. For example, if you are interested in all the pairwise comparisons here, there are 36 different $p$-values you would need to collect and adjust. Based on the model we just fitted, we have the following four comparisons.

| Pot/Food        | Pot/Food           | p         |
|-----------------|:------------------:|:---------:|
| Aluminum/Legume | Aluminum/Meat      | 0.303382  |
| Aluminum/Legume | Aluminum/Vegetable | 0.000243  |
| Aluminum/Legume | Clay/Legume        | 0.587740  |
| Aluminum/Legume | Iron/Legume        | 0.0000198 |

We would have to collect the remaining 32 different comparisons, and then we could put them in a vector and adjust using the Benjamani-Hochberg adjustment. Since all the predictors are categorical, we can also use the `pairwise.t.test()` function to quickly do this.

```{r}
pairwise.t.test(x = anemia$iron, g = anemia$food:anemia$pot, p.adjust.method = "BH")
```

The argument `x=` takes the outcome, and the `g=` argument takes the groups. We use the colon notation to define the groups (every pot/food combination). Finally we use the argument `p.adjust.method=` to specify the $p$-value adjustment method as Benjamani-Hochberg. This method will not work when any of the predictors are quantitative!

# Model Assumptions

Finally, we should again examine all of the model assumptions. Based on the plots (shown below) it seems that the assumptions seem reasonably satisfied.

```{r}
# Create fortified data
fort_lm4 = fortify(lm.4)
head(fort_lm4)


# Examine normality assumption
sm.density(fort_lm4$.stdresid, model = "normal", xlab = "Studentized Residuals")


# Examine other assumptions
ggplot(data = fort_lm4, aes(x = .fitted, y = .stdresid)) +
  geom_point() +
  geom_hline(yintercept = 0) +
  geom_hline(yintercept = c(-3, 3), linetype = "dotted") +
  geom_smooth(se = FALSE) +
  theme_bw() +
  xlab("Fitted Values") +
  ylab("Studentized Residuals")
```

